generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_URL")
  directUrl = env("POSTGRES_URL")
}

enum UserRole {
  ADMIN
  PARTICULAR
  AGENCIA
  DIFUSOR
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String?
  name          String?
  surname       String?
  phone         String?
  avatar        String?
  role          UserRole  @default(PARTICULAR)
  companyName   String?
  cif           String?
  website       String?
  licenseNumber String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  properties    Property[]
  favorites     Favorite[]
}

model Property {
  id                String    @id @default(cuid())
  userId            String?
  user              User?     @relation(fields: [userId], references: [id])
  address           String
  city              String?
  region            String?
  postcode          String?
  latitude          Float?
  longitude         Float?
  type              String    @default("Piso")
  floor             String?
  door              String?
  elevator          Boolean   @default(false)
  state             String?
  mBuilt            Float
  rooms             Int
  baths             Int
  pool              Boolean   @default(false)
  garage            Boolean   @default(false)
  terrace           Boolean   @default(false)
  garden            Boolean   @default(false)
  storage           Boolean   @default(false)
  ac                Boolean   @default(false)
  security          Boolean   @default(false)
  exterior          Boolean   @default(true)
  title             String?
  description       String?   @db.Text
  energyConsumption String?
  energyEmissions   String?
  energyPending     Boolean   @default(false)
  mainImage         String?
  images            Image[]
  price             Float?
  communityFees     Float?
  selectedServices  String[]
  serviceOrders     ServiceOrder[]
  status            String    @default("BORRADOR")
  views             Int       @default(0)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  favoritedBy       Favorite[]
}

model Image {
  id         String   @id @default(cuid())
  url        String
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model ServiceOrder {
  id         String   @id @default(cuid())
  serviceId  String
  name       String
  price      Float
  paid       Boolean  @default(false)
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
}

model Favorite {
  id         String   @id @default(cuid())
  userId     String
  propertyId String
  user       User     @relation(fields: [userId], references: [id])
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  @@unique([userId, propertyId])
}